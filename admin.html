<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin – Kollect Auctions</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- Burger Menu -->
<div class="burger" onclick="toggleMenu()">
  <div></div><div></div><div></div>
</div>

<!-- Navigation -->
<nav class="nav-menu" id="navMenu">
  <a href="index.html">Home</a>
  <a href="dashboard.html" id="dashboardNav" style="display:none;">Dashboard</a>
  <a href="about.html">About Us</a>
  <a href="live_auctions.html">Live Auctions</a>
  <a href="kollect_100.html">Kollect 100</a>
  <a href="private_sales.html">Private Sales</a>
  <a href="contact.html">Contact Us</a>
  <a href="admin.html">Admin</a>
  <a href="results.html">Results</a>
  <a href="create_account.html">Sign In</a>
</nav>
 <div id="user-status">Checking login status...</div> 
<div class="container">

  <!-- Password Screen -->
  <div id="password-screen" class="password-screen">
    <form id="password-form" class="password-form">
      <h2>Enter Admin Password</h2>
      <input type="password" id="admin-password" placeholder="Password" required>
      <button type="submit" class="button">Enter</button>
    </form>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" style="display:none;">
    
    <a href="index.html" class="button" style="margin-bottom: 20px; display: inline-block;">
      Home
    </a>

    <img src="IMG_1604.jpeg" alt="Kollect Auctions Logo" class="hero-image">
    <h1>Admin Panel</h1>
    <p>Only authorized personnel can access and manage auction data here.</p>

    <div class="card">
      <h3>View All Bids</h3>
      <p style="font-size:14px; opacity:0.8;">
        Showing live price from listings (10 per page)
      </p>
      <div id="bids-list"></div>
    </div>

    <div class="card">
      <h3>Ended Auctions</h3>
      <p style="font-size:14px; opacity:0.8;">
        Completed auctions with winner and final bid
      </p>
      <div id="ended-auctions-list"></div>
    </div>

    <div class="card">
      <h3>Add / Edit Item</h3>
      <form id="item-form">
        <input type="hidden" id="item_id" name="item_id">

        <input type="text" name="item_name" placeholder="Item Name" required>
        <textarea name="item_description" placeholder="Item Description"></textarea>

        <input type="number" name="item_price" placeholder="Price / Auction Start Price" required>

        <label>Price Type</label>
        <select name="price_type" required>
          <option value="fixed">Fixed Price</option>
          <option value="auction">Auction Start Price</option>
        </select>

        <label>Sale Type</label>
        <select name="sale_type" id="sale_type" required>
          <option value="">Select Type</option>
          <option value="private_sales">Private Sale</option>
          <option value="live_auctions">Live Auction</option>
          <option value="kollect_100">Kollect 100</option>
        </select>

        <div id="auction-fields" style="display:none;">
          <label>Auction Start</label>
          <input type="datetime-local" name="auctionstart">
          <label>Auction End</label>
          <input type="datetime-local" name="auctionend">
        </div>

        <label>Upload Image</label>
        <input type="file" name="item_image" id="item_image" accept="image/*">

        <button type="submit" class="button">Add / Update Item</button>
      </form>
    </div>

    <div class="card">
      <h3>Manage Items</h3>
      <div id="items-list"></div>
    </div>

  </div>
</div>

<!-- SAME SCRIPT AS WORKING PAGES -->
<script type="module" src="script.js"></script>

<!-- ADMIN LOGIC -->
<script type="module" src="admin.js"></script>

</body>
</html>



Make the live bids box html below pull live bids like the live bids code above but only if the bid matches the users email keep eveything else the exact same 

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard – Kollect Auctions</title>
<link rel="stylesheet" href="style.css">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, collection, query, where, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase.js";

// ---------- Firebase Initialization ----------
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ---------- DOM Elements ----------
const userStatus = document.getElementById("user-status");
const logoutButton = document.getElementById("logout-button");
const body = document.body;
const editBtn = document.getElementById("edit-btn");
const saveBtn = document.getElementById("save-btn");
const profilePicEl = document.getElementById("profile-pic");
const profileUpload = document.getElementById("profile-upload");
const bidsContainer = document.getElementById("won-bids-container");
const salesContainer = document.getElementById("purchase-history-container");
const welcomeName = document.getElementById("welcome-name");
const liveBidsContainer = document.getElementById("live-bids-container");

const fields = ["first-name-input","last-name-input","email-input","contact-input","address1-input","address2-input","city-input","postcode-input"];
const inputs = fields.map(f => document.getElementById(f));

// ---------- Burger Menu & Light/Dark Mode ----------
window.toggleMenu = () => document.getElementById("navMenu")?.classList.toggle("open");
if(localStorage.getItem("lightMode")==="true") body.classList.add("light-mode");
window.toggleMode = () => { const isLight = body.classList.toggle("light-mode"); localStorage.setItem("lightMode", isLight); };

// ---------- Logout ----------
window.logoutUser = async () => { try { await signOut(auth); window.location.href = "create_account.html"; } catch(e) { console.error(e); } };

// ---------- Helper ----------
const formatPrice = (price) => price ? "£" + Number(price).toLocaleString() : "£0";

// ---------- Auth ----------
onAuthStateChanged(auth, async (user) => {
  if (!user) return window.location.href = "create_account.html";
  const userUid = user.uid;
  const userEmail = user.email.toLowerCase();
  userStatus.textContent = `Logged in as ${user.email}`;
  logoutButton.style.display = "inline-block";

  // ---------- Profile ----------
  const docRef = doc(db, "users", userUid);
  onSnapshot(docRef, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data();
    // Populate fields with persisted values
    inputs.forEach(f => {
      const key = f.id.replace("-input","").toLowerCase();
      if(!f.value) f.value = data[key] || "";
    });
    welcomeName.textContent = data.firstname || "User";
    if (data.profilepicurl) profilePicEl.src = data.profilepicurl;
  });

  editBtn.addEventListener("click", () => {
    // Only remove readonly, do not clear values
    inputs.forEach(i => i.removeAttribute("readonly"));
    profileUpload.style.display = "block";
    editBtn.style.display = "none";
    saveBtn.style.display = "inline-block";
  });

  saveBtn.addEventListener("click", async () => {
    let profilepicurl = profilePicEl.src;
    if(profileUpload.files.length > 0){
      const file = profileUpload.files[0];
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "Profile_pictures"); 
      formData.append("folder", "profilePics");
      const url = `https://api.cloudinary.com/v1_1/def0sfrxq/image/upload`;
      const res = await fetch(url, { method:"POST", body: formData });
      profilepicurl = (await res.json()).secure_url;
      profilePicEl.src = profilepicurl;
    }
    const updatedData = {};
    inputs.forEach(f => { const key = f.id.replace("-input","").toLowerCase(); updatedData[key] = f.value.trim(); });
    updatedData.profilepicurl = profilepicurl;
    await updateDoc(docRef, updatedData);
    inputs.forEach(i => i.setAttribute("readonly",""));
    profileUpload.style.display = "none";
    editBtn.style.display = "inline-block";
    saveBtn.style.display = "none";
    welcomeName.textContent = updatedData.firstname || "User";
    alert("Profile updated!");
  });

  profileUpload.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if(file) profilePicEl.src = URL.createObjectURL(file);
  });

  // ---------- Live Bids only active listings ----------
  if (liveBidsContainer) {
    const liveBidsQuery = query(
      collection(db, "bids"),
      where("userid", "==", userUid),
      orderBy("timestamp", "desc")
    );

    const userLiveBidsMap = {};

    onSnapshot(liveBidsQuery, async snapshot => {
      snapshot.forEach(docSnap => {
        const bid = docSnap.data();
        const listingId = bid.listingid;
        const bidAmount = bid.bidamount;
        if (!userLiveBidsMap[listingId] || bidAmount > userLiveBidsMap[listingId].bidamount) {
          userLiveBidsMap[listingId] = { ...bid, id: docSnap.id };
        }
      });

      const bidsArray = Object.values(userLiveBidsMap);
      liveBidsContainer.innerHTML = "<h2>Your Live Bids</h2>";
      if (!bidsArray.length) {
        liveBidsContainer.innerHTML += "<p>No active bids yet.</p>";
        return;
      }

      // Fetch all listing names and filter only active
      const listingIds = [...new Set(bidsArray.map(b => b.listingid))];
      const listingsData = {};
      for(const id of listingIds){
        const listingSnap = await getDoc(doc(db,"listings",id));
        if(listingSnap.exists()) {
          const data = listingSnap.data();
          if(data.status === "live") listingsData[id] = data;
        }
      }

      bidsArray.forEach(bid => {
        if(!listingsData[bid.listingid]) return; // skip ended listings
        const bidEl = document.createElement("div");
        bidEl.className = "bid-card";
        const dateStr = bid.timestamp?.seconds ? new Date(bid.timestamp.seconds * 1000).toLocaleDateString() : "Unknown date";
        const link = document.createElement("a");
        const listingName = listingsData[bid.listingid]?.name || bid.listingid;
        link.href = `item.html?id=${bid.listingid}`;
        link.textContent = `${listingName} – ${formatPrice(bid.bidamount)} placed on ${dateStr}`;
        bidEl.appendChild(link);
        liveBidsContainer.appendChild(bidEl);
      });
    });
  }

  // ---------- Won Bids (optimized) ----------
  if (bidsContainer) {
    const wonBidsQuery = query(
      collection(db, "bids"),
      where("userid", "==", userUid),
      orderBy("timestamp", "desc")
    );

    onSnapshot(wonBidsQuery, async snapshot => {
      bidsContainer.innerHTML = "<h2>Won Bids</h2>";
      if(snapshot.empty){
        bidsContainer.innerHTML += "<p>No won bids yet.</p>";
        return;
      }

      const listingIds = [...new Set(snapshot.docs.map(d => d.data().listingid))];
      const listingsData = {};
      for(const id of listingIds){
        const listingSnap = await getDoc(doc(db,"listings",id));
        if(listingSnap.exists()) listingsData[id] = listingSnap.data();
      }

      snapshot.forEach(docSnap => {
        const bid = docSnap.data();
        const listing = listingsData[bid.listingid];
        if(!listing || listing.status !== "ended") return;

        const bidEl = document.createElement("div");
        bidEl.className = "bid-card";
        const dateStr = bid.timestamp?.seconds ? new Date(bid.timestamp.seconds * 1000).toLocaleDateString() : "Unknown date";
        const link = document.createElement("a");
        link.href = `item.html?id=${bid.listingid}`;
        link.textContent = `${listing.name || bid.listingid} – ${formatPrice(bid.bidamount)} won on ${dateStr}`;
        bidEl.appendChild(link);
        bidsContainer.appendChild(bidEl);
      });
    });
  }

  // ---------- Purchase History ----------
  const purchaseQuery = query(
    collection(db, "successfulsales"),
    where("buyerid", "==", user.uid),
    orderBy("date", "desc")
  );

  onSnapshot(purchaseQuery, (snapshot) => {
    if (!salesContainer) return;
    salesContainer.innerHTML = "<h2>Purchase History</h2>";
    if(snapshot.empty){
      salesContainer.innerHTML += "<p>No purchases yet.</p>";
      return;
    }
    snapshot.forEach(doc => {
      const sale = doc.data();
      const dateStr = sale.date?.seconds ? new Date(sale.date.seconds * 1000).toLocaleDateString() : "Unknown date";
      const saleEl = document.createElement("div");
      saleEl.className = "bid-card";
      const link = document.createElement("a");
      link.href = `item.html?id=${sale.itemid}`;
      link.textContent = `${sale.itemname} – ${formatPrice(sale.price)} (${sale.purchasetype}) on ${dateStr}`;
      saleEl.appendChild(link);
      salesContainer.appendChild(saleEl);
    });
  });

});
</script>

<style>
.container input { background-color:#1e1e1e; border:2px solid #FFD700; color:#fff; padding:8px; border-radius:4px; width:100%; margin:5px 0;}
.container ul{padding-left:0; list-style:none;}
.dashboard-cards{display:flex; flex-wrap:wrap; gap:15px; margin-top:20px;}
.dashboard-cards .card{flex:1 1 300px; min-width:280px;}
#bids-container,#purchase-history-container,#live-bids-container,#won-bids-container{padding:15px; background:#1e1e1e; border:2px solid #FFD700; border-radius:5px;}
.bid-card{background:#2a2a2a; border:1px solid #FFD700; padding:8px; margin-bottom:5px; border-radius:4px;}
.bid-card a{color:#FFD700; text-decoration:none; display:block;}
.bid-card a:hover{text-decoration:underline;}
#welcome-name{font-weight:normal; color:inherit; font-size:inherit;}
#logout-button,#edit-btn{background-color:#FFD700; color:#1e1e1e; font-weight:bold; border:2px solid #1e1e1e; border-radius:8px; padding:8px 16px; cursor:pointer; transition:all 0.3s ease; display:inline-block;}
#logout-button:hover,#edit-btn:hover{background-color:#fff; color:#FFD700; border:2px solid #FFD700; transform:scale(1.05);}
.consign-btn{display:inline-block; background-color:#FFD700; color:#1e1e1e; font-weight:bold; text-decoration:none; padding:10px 20px; border-radius:8px; border:2px solid #1e1e1e; transition:all 0.3s ease;}
.consign-btn:hover{background-color:#fff; color:#FFD700; border:2px solid #FFD700; transform:scale(1.05);}
@media(max-width:768px){.dashboard-cards{flex-direction:column;}}
</style>
</head>
<body>

<div class="burger" onclick="toggleMenu()"><div></div><div></div><div></div></div>

<nav class="nav-menu" id="navMenu">
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="live_auctions.html">Live Auctions</a>
  <a href="kollect_100.html">Kollect 100</a>
  <a href="private_sales.html">Private Sales</a>
  <a href="contact.html">Contact Us</a>
  <a href="admin.html">Admin</a>
  <a href="results.html">Results</a>
</nav>

<div id="user-status">Checking login status...</div>
<button id="logout-button" style="display:none;" onclick="logoutUser()">Logout</button>

<div class="container">
  <h1>Welcome, <span id="welcome-name">User</span></h1>

  <div style="margin: 15px 0;">
    <a href="contact.html" class="consign-btn">Consign an Item</a>
  </div>

  <div class="card">
    <h2>Your Profile</h2>
    <img id="profile-pic" src="default-profile.png" alt="Profile Picture" style="width:120px; height:120px; border-radius:50%; display:block; margin:0 auto 10px;">
    <input type="file" id="profile-upload" accept="image/*" style="display:none; margin-bottom:15px;">
    <ul>
      <li>First Name: <input id="first-name-input" readonly placeholder="First Name" /></li>
      <li>Last Name: <input id="last-name-input" readonly placeholder="Last Name" /></li>
      <li>Email: <input id="email-input" readonly placeholder="Email" /></li>
      <li>Contact: <input id="contact-input" readonly placeholder="Phone Number" /></li>
      <li>Address 1: <input id="address1-input" readonly placeholder="Address Line 1" /></li>
      <li>Address 2: <input id="address2-input" readonly placeholder="Address Line 2" /></li>
      <li>City: <input id="city-input" readonly placeholder="City" /></li>
      <li>Postcode: <input id="postcode-input" readonly placeholder="Postcode" /></li>
    </ul>
    <div style="margin-top:10px;">
      <button id="edit-btn">Edit Profile</button>
      <button id="save-btn" style="display:none;">Save Profile</button>
    </div>
  </div>

  <div class="dashboard-cards">
    <div id="won-bids-container" class="card">
      <h2>Won Bids</h2>
      <p>Loading your won bids…</p>
    </div>

    <div id="purchase-history-container" class="card">
      <h2>Purchase History</h2>
      <p>Loading your purchase history…</p>
    </div>

    <div id="live-bids-container" class="card">
      <h2>Your Live Bids</h2>
      <p>Loading your live bids…</p>
    </div>
  </div>
</div>

</body>
</html>
