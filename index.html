<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kollect Auctions</title>
<link rel="stylesheet" href="style.css">

<script type="module" src="firebase.js"></script>

<!-- ✅ Load saved mode BEFORE page renders (DEFAULT = DARK) -->
<script>
(function () {
  const savedMode = localStorage.getItem("theme");

  if (savedMode === "light") {
    document.documentElement.classList.add("light-mode");
  } else {
    // Default to dark if nothing saved
    document.documentElement.classList.add("dark-mode");
  }
})();
</script>

<style>
/* Hero Buttons Flex Layout */
#heroButtons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

#heroButtons .button {
  flex: 1 1 auto;
  min-width: 120px;
  text-align: center;
  padding: 10px 20px;
}

/* Search Results Cards */
#searchResults {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 20px;
}

#searchResults .card {
  width: 100%;
  max-width: 220px;
  border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
}

/* Remove blue border around images */
img {
  border: none;
  outline: none;
}
</style>
</head>

<body>

<!-- Burger Menu -->
<div class="burger" onclick="toggleMenu()">
  <div></div><div></div><div></div>
</div>

<!-- Navigation -->
<nav class="nav-menu" id="navMenu">
  <a href="index.html">Home</a>
  <a href="dashboard.html" id="dashboardNav" style="display:none;">Dashboard</a>
  <a href="about.html">About Us</a>
  <a href="live_auctions.html">Live Auctions</a>
  <a href="kollect_100.html">Kollect 100</a>
  <a href="private_sales.html">Private Sales</a>
  <a href="contact.html">Contact Us</a>
  <a href="admin.html">Admin</a>
  <a href="results.html">Results</a>
  <a href="create_account.html">Sign In</a>
</nav>

<!-- User Status -->
<div id="user-status">Checking login status...</div>

<!-- Main Container -->
<div class="container">
  <img src="IMG_1685.jpeg" alt="Kollect Auctions Logo" class="hero-image">

  <!-- Hero Buttons -->
  <div id="heroButtons">
    <a href="private_sales.html" class="button">Private Sales</a>
    <a href="live_auctions.html" class="button">Live Auctions</a>
    <a href="dashboard.html" class="button" id="dashboardButton" style="display:none;">Dashboard</a>
  </div>

  <!-- Simplified Search Bar -->
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search items...">
    <select id="typeSelect">
      <option value="auction">Auction</option>
      <option value="private">Private Sale</option>
    </select>
    <button class="button" id="searchBtn">Search</button>
  </div>

  <!-- Search Results -->
  <div id="searchResults"></div>
</div>

<script type="module">
import { db } from './firebase.js';
import { collection, getDocs, query } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { auth } from './firebase.js';
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const userStatus = document.getElementById("user-status");
const dashboardBtn = document.getElementById("dashboardButton");
const dashboardNav = document.getElementById("dashboardNav");
const searchBtn = document.getElementById("searchBtn");
const searchInput = document.getElementById("searchInput");
const typeSelect = document.getElementById("typeSelect");
const searchResults = document.getElementById("searchResults");

// ---------- Auth ----------
onAuthStateChanged(auth, (user) => {
  if (user) {
    userStatus.textContent = `Logged in as ${user.email}`;
    dashboardBtn.style.display = "inline-block";
    dashboardNav.style.display = "inline-block";
  } else {
    userStatus.textContent = "";
    dashboardBtn.style.display = "none";
    dashboardNav.style.display = "none";
  }
});

// ---------- Burger ----------
window.toggleMenu = () => {
  document.getElementById("navMenu").classList.toggle("open");
};

// ---------- Dark / Light Mode ----------
window.toggleMode = () => {
  const root = document.documentElement;

  if (root.classList.contains("dark-mode")) {
    root.classList.remove("dark-mode");
    root.classList.add("light-mode");
    localStorage.setItem("theme", "light");
  } else {
    root.classList.remove("light-mode");
    root.classList.add("dark-mode");
    localStorage.setItem("theme", "dark");
  }
};

// ---------- Search Function ----------
searchBtn.addEventListener("click", async () => {
  const searchText = searchInput.value.trim().toLowerCase();
  const type = typeSelect.value;
  searchResults.innerHTML = "";

  if (!searchText) return;

  const collName = type === "private" ? "privatesales" : "listings";
  const pageUrl = type === "private" ? "private_sales.html" : "live_auctions.html";
  const q = query(collection(db, collName));
  const snapshot = await getDocs(q);

  snapshot.forEach(docSnap => {
    const item = docSnap.data();
    const docId = docSnap.id;
    const name = item.name?.toLowerCase() || "";

    if (type === "auction" && item.pricetype !== "auction") return;
    if (type === "auction" && item.status !== "live") return;
    if (!name.includes(searchText)) return;

    const price = type === "auction" ? (item.winningbid || item.price) : item.price;
    const imageTag = item.image ? `<img src="${item.image}" style="width:100%;max-width:200px;">` : "";

    searchResults.innerHTML += `
      <div class="card">
        ${imageTag}
        <h3>${item.name}</h3>
        <p>Price: £${price}</p>
        ${type === "auction" ? `<p>Highest Bidder: ${item.winneremail || "No bids"}</p>` : ""}
        <button class="button" onclick="window.location='${pageUrl}#${docId}'">View Item</button>
      </div>
    `;
  });
});
</script>

<!-- Global Notifications JS -->
<script src="/js/notification.js"></script>
  
</body>
</html>
