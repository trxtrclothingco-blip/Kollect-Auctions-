<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact – Kollect Auctions</title>
<link rel="stylesheet" href="style.css">

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>

<!-- Your other scripts -->
<script type="module" src="firebase.js"></script>
<script type="module" src="script.js"></script>
</head>
<body>

<div class="burger" onclick="toggleMenu()">
  <div></div><div></div><div></div>
</div>

<nav class="nav-menu" id="navMenu">
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="about.html">About Us</a>
  <a href="live_auctions.html">Live Auctions</a>
  <a href="kollect_100.html">Kollect 100</a>
  <a href="private_sales.html">Private Sales</a>
  <a href="contact.html">Contact Us</a>
  <a href="admin.html">Admin</a>
  <a href="results.html">Results</a>
  <a href="create_account.html">Sign In</a>
  <button id="modeToggle" onclick="toggleMode()">Toggle Light/Dark Mode</button>
</nav>

<div id="user-status">Checking login status...</div>
<button id="logout-button" style="display:none;" onclick="logoutUser()">Logout</button>

<div class="container">
  <img src="IMG_1604.jpeg" alt="Kollect Auctions Logo" class="hero-image">

  <h1>Contact Us</h1>
  <p>Submit your collectible or get in touch with our team.</p>

  <div class="card">
    <form id="contact-form" enctype="multipart/form-data">
      <!-- User Info -->
      <input type="text" name="name" placeholder="Full Name" required>
      <input type="email" name="email" placeholder="Email Address" required>
      <input type="tel" name="phone" placeholder="Phone Number" required>

      <!-- Item Info -->
      <input type="text" name="item_name" placeholder="Item Name" required>
      <input type="text" name="estimated_value" placeholder="Estimated Value (£)" required>
      <textarea name="item_description" rows="4" placeholder="Item Description"></textarea>

      <!-- Sale Type -->
      <select name="sale_type" required>
        <option value="">Select Sale Type</option>
        <option value="auction">Auction</option>
        <option value="private">Private Sale</option>
      </select>

      <!-- File Upload -->
      <label for="item_image">Upload Image(s)</label>
      <input type="file" name="item_image" id="item_image" multiple>

      <!-- Hidden fields for EmailJS -->
      <input type="hidden" name="time" id="time">
      <input type="hidden" name="file_urls" id="file_urls">

      <button class="button" type="submit">Submit</button>
    </form>
  </div>
</div>

<!-- Initialize EmailJS with Public Key -->
<script type="text/javascript">
  (function(){
    emailjs.init("Fx2CfwymZU9f86Gfl"); // <-- updated public key
  })();
</script>

<!-- EmailJS Form Submission with Firebase Upload -->
<script>
document.getElementById("contact-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const form = this;

  // Set timestamp
  document.getElementById("time").value = new Date().toLocaleString();

  const files = document.getElementById("item_image").files;
  if (!files.length) {
    alert("Please upload at least one image.");
    return;
  }

  try {
    const urls = [];

    // Upload files to Firebase Storage
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const storageRef = firebase.storage().ref();
      const fileRef = storageRef.child(`contact_uploads/${Date.now()}_${file.name}`);
      await fileRef.put(file);
      const downloadURL = await fileRef.getDownloadURL();
      urls.push(downloadURL);
    }

    // Add URLs to hidden field
    document.getElementById("file_urls").value = urls.join(", ");

    // Send form via EmailJS
    emailjs.sendForm(
      "service_899s2nl",    // Your Service ID
      "template_2sqqyrk",   // Your Template ID
      form
    ).then(
      function() {
        alert("Submission sent successfully!");
        form.reset();
      },
      function(error) {
        alert("FAILED... " + error.text);
      }
    );

  } catch (err) {
    console.error(err);
    alert("Error uploading files: " + err.message);
  }
});
</script>

</body>
</html>
