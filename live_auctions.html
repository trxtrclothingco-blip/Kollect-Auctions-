<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Auctions</title>
<link rel="stylesheet" href="style.css">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { firebaseConfig } from "./firebase.js";

// ---------- Firebase Init ----------
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ---------- DOM Elements ----------
const userStatus = document.getElementById("user-status");
const logoutButton = document.getElementById("logout-button");
const body = document.body;
const container = document.querySelector(".container");

// ---------- Burger Menu & Mode ----------
window.toggleMenu = () => document.getElementById("navMenu")?.classList.toggle("open");
if(localStorage.getItem("lightMode")==="true") body.classList.add("light-mode");
window.toggleMode = () => {
  const isLight = body.classList.toggle("light-mode");
  localStorage.setItem("lightMode", isLight);
};

// ---------- Logout ----------
window.logoutUser = async () => {
  try { 
    await signOut(auth); 
    window.location.href = "create_account.html";
  } catch(e) { console.error("Logout failed:", e); }
};

// ---------- Auth Status ----------
onAuthStateChanged(auth, (user) => {
  if(user){
    userStatus.textContent = `Logged in as ${user.email}`;
    logoutButton.style.display = "inline-block";
  } else {
    userStatus.textContent = `Not signed in`;
    logoutButton.style.display = "none";
  }
});

// ---------- Load Live Listings ----------
const listingsRef = collection(db, "listings");
const listingsQuery = query(listingsRef, orderBy("createdAt","desc"));

onSnapshot(listingsQuery, (snapshot) => {
  // Remove previous cards
  const oldCards = container.querySelectorAll(".auction-card");
  oldCards.forEach(c => c.remove());

  if(snapshot.empty){
    container.innerHTML += `<p>No live auctions available.</p>`;
    return;
  }

  snapshot.forEach(doc => {
    const item = doc.data();

    // Create card
    const card = document.createElement("div");
    card.className = "card auction-card";

    // Image
    const img = document.createElement("img");
    img.src = item["image:"] || "default-image.png";
    img.alt = item.name || "Auction Item";

    // Title
    const title = document.createElement("h3");
    title.textContent = item.name || "Unnamed Item";

    // Description
    const desc = document.createElement("p");
    desc.textContent = item.description || "";

    // Price
    const price = document.createElement("p");
    price.textContent = item.price ? `${item.priceType || "Â£"}${Number(item.price).toLocaleString()}` : "Price N/A";

    // Sale Type
    const sale = document.createElement("p");
    sale.textContent = item.saleType ? `Sale Type: ${item.saleType}` : "";

    // Button
    const button = document.createElement("button");
    button.className = "button";
    button.textContent = "Bid Now";
    button.onclick = () => window.location = `item.html?id=${doc.id}`;

    // Append
    card.appendChild(img);
    card.appendChild(title);
    card.appendChild(desc);
    card.appendChild(price);
    if(item.saleType) card.appendChild(sale);
    card.appendChild(button);

    container.appendChild(card);
  });
});
</script>

<style>
/* Modern bold heading for Live Auctions */
.live-auctions-title {
  font-family: "Arial Black", sans-serif;
  font-size: 3rem;
  font-weight: 900;
  color: #FFD700;
  text-align: center;
  margin: 30px 0;
}

/* Responsive for smaller screens */
@media (max-width: 768px){
  .live-auctions-title {
    font-size: 2.2rem;
    margin: 20px 0;
  }
}

/* Auction Cards */
.auction-card {
  background: #2a2a2a;
  border: 2px solid #FFD700;
  border-radius: 8px;
  padding: 10px;
  max-width: 300px;
  margin: 15px;
  display: inline-block;
  vertical-align: top;
  text-align: center;
}

.auction-card img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 6px;
}

.auction-card h3 {
  margin: 10px 0 5px;
  color: #FFD700;
}

.auction-card p {
  margin: 5px 0;
}

.auction-card .button {
  background: #FFD700;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  margin-top: 10px;
  cursor: pointer;
  font-weight: bold;
}

.auction-card .button:hover {
  background: #fff;
  color: #FFD700;
}

/* Responsive container */
.container {
  text-align: center;
}

@media (max-width: 768px){
  .auction-card {
    max-width: 90%;
    margin: 10px auto;
  }
}
</style>

</head>
<body>

<!-- Burger Menu -->
<div class="burger" onclick="toggleMenu()">
  <div></div><div></div><div></div>
</div>

<!-- Navigation -->
<nav class="nav-menu" id="navMenu">
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="about.html">About Us</a>
  <a href="live_auctions.html">Live Auctions</a>
  <a href="kollect_100.html">Kollect 100</a>
  <a href="private_sales.html">Private Sales</a>
  <a href="contact.html">Contact Us</a>
  <a href="admin.html">Admin</a>
  <a href="results.html">Results</a>
  <a href="create_account.html">Sign In</a>
  <button id="modeToggle" onclick="toggleMode()">Toggle Light/Dark Mode</button>
</nav>

<!-- User Status & Logout -->
<div id="user-status">Checking login status...</div>
<button id="logout-button" style="display:none;" onclick="logoutUser()">Logout</button>

<!-- Main Container -->
<div class="container">
  <img src="IMG_1604.jpeg" alt="Kollect Auctions Logo" class="hero-image">
  <a href="private_sales.html" class="button">Private Sales</a>

  <!-- Bold Live Auctions Title -->
  <div class="live-auctions-title">Live Auctions</div>
</div>

</body>
</html>
